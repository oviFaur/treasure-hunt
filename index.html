<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Treasure Hunt — Clue</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:24px;max-width:720px}
    label{display:block;margin-top:12px}
    input,button{padding:10px;font-size:16px;width:100%;box-sizing:border-box}
    button{margin-top:12px;cursor:pointer}
    .ok{color:green}.err{color:#b00}
  </style>
</head>
<body>
  <h2>Clue</h2>
  <p>Introduceți <b>Team ID</b> și <b>Parola</b>. (Linkul poate precompleta câmpurile.)</p>

  <label>Team ID</label>
  <input id="team" placeholder="ex: EchipaA" />

  <label>Parola</label>
  <input id="pwd" type="password" placeholder="fraza secretă" />

  <button id="check">Verifică</button>
  <p style="margin-top:8px">Clue ID: <code id="clueLabel">clue1</code></p>

  <div id="out" style="margin-top:14px"></div>

  <script>
    // pre-populate din query ?clue=clue1&team=EchipaA
    (function () {
      const q = new URLSearchParams(location.search);
      const team = q.get('team'); const clue = q.get('clue');
      if (team) document.getElementById('team').value = team;
      document.getElementById('clueLabel').textContent = clue || 'clue1';
    })();

    document.getElementById('check').addEventListener('click', async () => {
      const team = (document.getElementById('team').value || '').trim();
      const pwd  = document.getElementById('pwd').value || '';
      const clue = document.getElementById('clueLabel').textContent || 'clue1';
      const out = document.getElementById('out');
      if (!team || !pwd) { out.innerHTML = '<span class="err">Completează team și parolă.</span>'; return; }

      out.textContent = 'Verific...';
      try {
        const res = await fetch('/.netlify/functions/verify', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ team, clue, password: pwd })
        });
        const j = await res.json();
        if (j.ok) {
          out.innerHTML = `<div class="ok"><b>Corect!</b><br>${j.nextText || ''}</div>`;
          if (j.nextUrl) out.innerHTML += `<div style="margin-top:8px"><a href="${j.nextUrl}">Mergi mai departe</a></div>`;
        } else {
          out.innerHTML = `<span class="err">Parolă greșită.</span>`;
        }
      } catch (e) {
        out.innerHTML = `<span class="err">Eroare de rețea. Încearcă din nou.</span>`;
      }
    });
  </script>
</body>
</html>
